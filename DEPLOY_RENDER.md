# Deploy no Render com GitHub - Guia Completo

Guia para hospedar sua aplica√ß√£o MCJ usando Render com integra√ß√£o GitHub.

## üèóÔ∏è Arquitetura Render

```
GitHub ‚Üí Render (Auto Deploy) ‚Üí Aplica√ß√£o Live
   ‚Üì           ‚Üì                    ‚Üì
 Push      Build & Deploy      https://seu-app.onrender.com
```

## üöÄ Vantagens do Render

- ‚úÖ **Deploy autom√°tico** via GitHub
- ‚úÖ **HTTPS gratuito** com certificados SSL
- ‚úÖ **Dom√≠nios customizados**
- ‚úÖ **Logs em tempo real**
- ‚úÖ **Escalabilidade autom√°tica**
- ‚úÖ **Tier gratuito** generoso (750h/m√™s)
- ‚úÖ **PostgreSQL** gerenciado
- ‚úÖ **Redis** para cache
- ‚úÖ **Mais simples** que AWS/Google Cloud

## üìã Pr√©-requisitos

1. **Conta GitHub** com reposit√≥rio do projeto
2. **Conta Render** (gratuita)
3. **C√≥digo no GitHub** (p√∫blico ou privado)

## üîß Op√ß√µes de Deploy

### **Op√ß√£o 1: Render + Supabase** (Recomendado)
- **Frontend:** Render Static Site
- **Backend:** Supabase (PostgreSQL + Auth + Real-time)
- **Custo:** Gratuito
- **Complexidade:** Baixa

### **Op√ß√£o 2: Render Completo**
- **Frontend:** Render Static Site
- **Backend:** Render Web Service
- **Database:** Render PostgreSQL
- **Custo:** ~$7-15/m√™s
- **Complexidade:** M√©dia

### **Op√ß√£o 3: Render Fullstack**
- **Tudo em um:** Render Web Service (Node.js serve React)
- **Database:** Render PostgreSQL ou Supabase
- **Custo:** ~$7/m√™s
- **Complexidade:** Baixa

## üöÄ Deploy Op√ß√£o 1: Render + Supabase

### Passo 1: Preparar Reposit√≥rio GitHub

#### 1.1 Criar reposit√≥rio (se n√£o existir)
```bash
# No diret√≥rio do projeto
git init
git add .
git commit -m "Initial commit"
git branch -M main
git remote add origin https://github.com/seu-usuario/mcj-app.git
git push -u origin main
```

#### 1.2 Configurar para Render
Crie `render.yaml` na raiz:
```yaml
services:
  - type: web
    name: mcj-frontend
    env: static
    buildCommand: cd client && npm install && npm run build
    staticPublishPath: ./client/build
    routes:
      - type: rewrite
        source: /*
        destination: /index.html
    envVars:
      - key: REACT_APP_SUPABASE_URL
        value: https://seu-projeto.supabase.co
      - key: REACT_APP_SUPABASE_ANON_KEY
        value: sua_anon_key_aqui
```

### Passo 2: Deploy no Render

#### 2.1 Conectar GitHub
1. Acesse [Render Dashboard](https://dashboard.render.com)
2. Clique em **"New +"** ‚Üí **"Static Site"**
3. Conecte sua conta GitHub
4. Selecione o reposit√≥rio `mcj-app`

#### 2.2 Configurar Build
```
Build Command: cd client && npm install && npm run build
Publish Directory: client/build
Branch: main
```

#### 2.3 Configurar Vari√°veis de Ambiente
```
REACT_APP_SUPABASE_URL=https://seu-projeto.supabase.co
REACT_APP_SUPABASE_ANON_KEY=sua_anon_key_aqui
```

#### 2.4 Deploy
1. Clique em **"Create Static Site"**
2. Aguarde o build (3-5 minutos)
3. Acesse a URL gerada: `https://mcj-app.onrender.com`

## üöÄ Deploy Op√ß√£o 2: Render Completo

### Passo 1: Configurar Backend

#### 1.1 Ajustar package.json (raiz)
```json
{
  "scripts": {
    "start": "node server.js",
    "build": "cd client && npm install && npm run build",
    "render-build": "npm install && npm run build",
    "dev": "concurrently \"npm run server\" \"npm run client\"",
    "server": "nodemon server.js",
    "client": "cd client && npm start"
  },
  "engines": {
    "node": ">=18.0.0"
  }
}
```

#### 1.2 Ajustar server.js
```javascript
const express = require('express')
const path = require('path')
const cors = require('cors')
const http = require('http')
const socketIo = require('socket.io')
require('dotenv').config()

const app = express()
const server = http.createServer(app)

// CORS para Render
app.use(cors({
  origin: process.env.NODE_ENV === 'production' 
    ? ['https://seu-frontend.onrender.com'] 
    : ['http://localhost:3000'],
  credentials: true
}))

// Socket.io
const io = socketIo(server, {
  cors: {
    origin: process.env.NODE_ENV === 'production' 
      ? ['https://seu-frontend.onrender.com'] 
      : ['http://localhost:3000'],
    credentials: true
  }
})

// Middleware
app.use(express.json())
app.use(express.urlencoded({ extended: true }))

// Rotas da API
app.use('/api/auth', require('./routes/auth'))
app.use('/api/songs', require('./routes/songs'))
app.use('/api/schedules', require('./routes/schedules'))
app.use('/api/members', require('./routes/members'))
app.use('/api/chat', require('./routes/chat'))
app.use('/api/reports', require('./routes/reports'))

// Servir arquivos est√°ticos do React (produ√ß√£o)
if (process.env.NODE_ENV === 'production') {
  app.use(express.static(path.join(__dirname, 'client/build')))
  
  app.get('*', (req, res) => {
    res.sendFile(path.join(__dirname, 'client/build', 'index.html'))
  })
}

// Socket.io handlers
io.on('connection', (socket) => {
  console.log('Usu√°rio conectado:', socket.id)
  
  socket.on('join-schedule', (scheduleId) => {
    socket.join(scheduleId)
    console.log(`Usu√°rio ${socket.id} entrou na escala ${scheduleId}`)
  })
  
  socket.on('send-message', (data) => {
    io.to(data.scheduleId).emit('new-message', data)
  })
  
  socket.on('disconnect', () => {
    console.log('Usu√°rio desconectado:', socket.id)
  })
})

const PORT = process.env.PORT || 5000
server.listen(PORT, '0.0.0.0', () => {
  console.log(`Servidor rodando na porta ${PORT}`)
})
```

### Passo 2: Configurar Database

#### 2.1 Criar PostgreSQL no Render
1. No dashboard, clique **"New +"** ‚Üí **"PostgreSQL"**
2. Configure:
   - **Name:** `mcj-database`
   - **Database:** `mcj_db`
   - **User:** `mcj_user`
3. Anote as credenciais geradas

#### 2.2 Configurar Conex√£o
Crie `database-postgres.js`:
```javascript
const { Pool } = require('pg')

const pool = new Pool({
  connectionString: process.env.DATABASE_URL,
  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false
})

// Criar tabelas
const createTables = async () => {
  try {
    await pool.query(`
      CREATE TABLE IF NOT EXISTS users (
        id SERIAL PRIMARY KEY,
        name VARCHAR(255) NOT NULL,
        email VARCHAR(255) UNIQUE NOT NULL,
        password VARCHAR(255) NOT NULL,
        role VARCHAR(50) DEFAULT 'member',
        ministry VARCHAR(255),
        phone VARCHAR(20),
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
      )
    `)
    
    await pool.query(`
      CREATE TABLE IF NOT EXISTS songs (
        id SERIAL PRIMARY KEY,
        title VARCHAR(255) NOT NULL,
        artist VARCHAR(255),
        key VARCHAR(10),
        tempo INTEGER,
        youtube_url TEXT,
        lyrics TEXT,
        chords TEXT,
        multitrack_files JSONB DEFAULT '[]',
        created_by INTEGER REFERENCES users(id),
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
      )
    `)
    
    // Adicionar outras tabelas...
    
    console.log('‚úÖ Tabelas criadas com sucesso')
  } catch (error) {
    console.error('‚ùå Erro criando tabelas:', error)
  }
}

module.exports = { pool, createTables }
```

### Passo 3: Deploy Backend

#### 3.1 Criar Web Service
1. **"New +"** ‚Üí **"Web Service"**
2. Conectar reposit√≥rio GitHub
3. Configurar:
   ```
   Build Command: npm run render-build
   Start Command: npm start
   ```

#### 3.2 Configurar Vari√°veis
```
NODE_ENV=production
DATABASE_URL=postgresql://user:pass@host:port/db
JWT_SECRET=seu_jwt_secret_super_seguro
PORT=10000
```

## üîß Deploy Op√ß√£o 3: Render Fullstack

### Configurar render.yaml
```yaml
services:
  - type: web
    name: mcj-fullstack
    env: node
    plan: starter
    buildCommand: npm install && cd client && npm install && npm run build && cd ..
    startCommand: npm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: DATABASE_URL
        fromDatabase:
          name: mcj-database
          property: connectionString
      - key: JWT_SECRET
        generateValue: true

databases:
  - name: mcj-database
    plan: starter
```

## üåê Configurar Dom√≠nio Customizado

### 1. No Render Dashboard
1. V√° para seu servi√ßo
2. **Settings** ‚Üí **Custom Domains**
3. Adicione: `mcjapp.com.br`

### 2. Configurar DNS
```
Tipo: CNAME
Nome: @
Valor: seu-app.onrender.com
```

## üîÑ CI/CD Autom√°tico

### Auto Deploy
- ‚úÖ **Push para main** ‚Üí Deploy autom√°tico
- ‚úÖ **Pull Request** ‚Üí Preview deploy
- ‚úÖ **Rollback** ‚Üí Vers√£o anterior

### Configurar Branch
```yaml
# render.yaml
services:
  - type: web
    name: mcj-app
    branch: main  # ou production
    autoDeploy: true
```

## üìä Monitoramento

### Logs em Tempo Real
```bash
# Via dashboard ou CLI
render logs -s mcj-app
```

### M√©tricas
- **CPU/Memory** usage
- **Response time**
- **Error rate**
- **Deploy history**

## üí∞ Custos Render

### Tier Gratuito
- **Static Sites:** Ilimitados
- **Web Services:** 750h/m√™s
- **PostgreSQL:** 90 dias
- **Bandwidth:** 100GB/m√™s

### Planos Pagos
- **Starter:** $7/m√™s (Web Service)
- **Standard:** $25/m√™s (mais recursos)
- **PostgreSQL:** $7/m√™s (persistente)

## üö® Troubleshooting

### Build Falha
```bash
# Verificar logs no dashboard
# Comum: vers√£o Node.js
"engines": {
  "node": ">=18.0.0"
}
```

### CORS Error
```javascript
// server.js
app.use(cors({
  origin: [
    'https://seu-frontend.onrender.com',
    'http://localhost:3000'
  ],
  credentials: true
}))
```

### Database Connection
```javascript
// Verificar DATABASE_URL
console.log('DB URL:', process.env.DATABASE_URL)
```

## ‚úÖ Checklist Final

### Prepara√ß√£o:
- [ ] C√≥digo no GitHub
- [ ] package.json configurado
- [ ] Vari√°veis de ambiente definidas
- [ ] Scripts de build funcionando

### Deploy:
- [ ] Servi√ßo criado no Render
- [ ] Build executado com sucesso
- [ ] Aplica√ß√£o acess√≠vel
- [ ] Database conectado (se aplic√°vel)

### P√≥s-Deploy:
- [ ] Dom√≠nio customizado (opcional)
- [ ] HTTPS funcionando
- [ ] Logs sem erros
- [ ] Funcionalidades testadas

## üéØ Recomenda√ß√£o para MCJ

**Para sua aplica√ß√£o MCJ, recomendo:**

1. **Render Static Site** (frontend) + **Supabase** (backend)
   - ‚úÖ Mais simples
   - ‚úÖ Mais barato
   - ‚úÖ Mais moderno
   - ‚úÖ Real-time nativo

2. **Render Web Service** (fullstack) se quiser manter Node.js
   - ‚úÖ Controle total
   - ‚úÖ Socket.io customizado
   - ‚ùå Mais caro
   - ‚ùå Mais complexo

---

**üöÄ Com Render + GitHub, voc√™ ter√° deploy autom√°tico e uma aplica√ß√£o profissional no ar em minutos!**